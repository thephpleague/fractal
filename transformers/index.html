<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="icon" type="image/x-icon" href="/themes/thephpleague/thephpleague.github.com/img/favicon.ico" />
                <link rel="apple-touch-icon-precomposed" href="/themes/thephpleague/thephpleague.github.com/img/apple-touch-icon-precomposed.png">
                <title>Transformers - Fractal</title>
                <meta name="description" content="Fractal provides a presentation and transformation layer for complex data output, the like found in AJAX and RESTful APIs.">
                <link rel="stylesheet" href="/themes/thephpleague/thephpleague.github.com/css/all.css">
    </head>
<body>

<section class="all_packages">
    <a href="http://thephpleague.com/">
        <img src="/themes/thephpleague/thephpleague.github.com/img/loep_logo.png" width="195" height="200" alt="The League of Extraordinary Packages">
    </a>
    <h2>Our Packages:</h2>
    <ul>
    </ul>
</section>

<header>
    <a class="logo" href="/">
                <span class="name">Fractal</span>
        <span class="tagline">Output complex, flexible, AJAX/RESTful data structures.</span>
    </a>
    <a href="http://thephpleague.com/" class="league">
        Presented by The League of Extraordinary Packages
    </a>
</header>

<input type="checkbox" id="menu">
<label for="menu" onclick>
    <div class="closed">&#9776; Menu</div>
    <div class="open">&#9776; Hide Menu</div>
</label>

<main>
    <menu>
                    <h2>Getting Started</h2>
            <ul>
                                    <li >
                        <a href="/">Introduction</a>
                    </li>
                                    <li >
                        <a href="/simple-example/">Simple Example</a>
                    </li>
                                    <li >
                        <a href="/installation/">Installation</a>
                    </li>
                                    <li >
                        <a href="/glossary/">Glossary</a>
                    </li>
                            </ul>
                    <h2>Concepts</h2>
            <ul>
                                    <li >
                        <a href="/resources/">Resources</a>
                    </li>
                                    <li >
                        <a href="/serializers/">Serializers</a>
                    </li>
                                    <li class="selected">
                        <a href="/transformers/">Transformers</a>
                    </li>
                                    <li >
                        <a href="/pagination/">Pagination</a>
                    </li>
                            </ul>
            </menu>
    <article>
        <h1>Transformers</h1>

<p>In the <a href="/resources/">Resources</a> section the examples show off callbacks for 
transformers, but these are of limited use:</p>

<pre><code class="language-php">use Acme\Model\Book;
use League\Fractal;

$books = Book::all();

$resource = new Fractal\Resource\Collection($books, function(Book $book) {
    return [
        'id'      =&gt; (int) $book-&gt;id,
        'title'   =&gt; $book-&gt;title,
        'year'    =&gt; $book-&gt;yr,
        'author'  =&gt; [
            'name'  =&gt; $book-&gt;author_name,
            'email' =&gt; $book-&gt;author_email,
        ],
        'links'   =&gt; [
            [
                'rel' =&gt; 'self',
                'uri' =&gt; '/books/'.$book-&gt;id,
            ]
        ]
    ];
});
</code></pre>

<p>These can be handy in some situations, but most data will need to be transformed multiple
times and in multiple locations, so creating classes to do this work can save code 
duplication.</p>

<h2>Classes for Transformers</h2>

<p>To reuse transformers (recommended) classes can be defined, instantiated and 
passed in place of the callback.</p>

<p>These classes must extend <code>League\Fractal\TransformerAbstract</code> and contain at the very 
least a method with the name <code>transform()</code>.</p>

<p>The method declaraton can take mixed input, just like the callbacks:</p>

<pre><code class="language-php">namespace Acme\Transformer;

use Acme\Model\Book;
use League\Fractal;

class BookTransformer extends Fractal\TransformerAbstract
{
    public function transform(Book $book)
    {
        return [
            'id'      =&gt; (int) $book-&gt;id,
            'title'   =&gt; $book-&gt;title,
            'year'    =&gt; (int) $book-&gt;yr,
            'links'   =&gt; [
                [
                    'rel' =&gt; 'self',
                    'uri' =&gt; '/books/'.$book-&gt;id,
                ]
            ],
        ];
    }
}
</code></pre>

<p>Once the Transformer class is defined, it can be passed as an instance in the 
resource constructor.</p>

<pre><code class="language-php">use Acme\Transformer\BookTransformer;
use League\Fractal;

$resource = new Fractal\Resource\Item($book, new BookTransformer);
$resource = new Fractal\Resource\Collection($books, new BookTransformer);
</code></pre>

<h2>Including Data</h2>

<p>Your transformer at this point is mainly just giving you a method to handle array conversion from
you data source (or whatever your model is returning) to a simple array. Including data in an
intelligent way can be tricky as data can have all sorts of relationships. Many developers try to
find a perfect balance between not making too many HTTP requests and not downloading more data than
they need to, so flexibility is also important.</p>

<p>Sticking with the book example, the <code>BookTransformer</code>, we might want to normalize our database and take
the two <code>author_*</code> fields out and put them in their own table. This include can be optional to reduce the size of the JSON response and is defined like so:</p>

<pre><code class="language-php">&lt;?php namespace App\Transformer;

use Acme\Model\Book;
use League\Fractal\TransformerAbstract;

class BookTransformer extends TransformerAbstract
{
    /**
     * List of resources possible to include
     *
     * @var array
     */
    protected $availableIncludes = [
        'author'
    ];

    /**
     * Turn this item object into a generic array
     *
     * @return array
     */
    public function transform(Book $book)
    {
        return [
            'id'    =&gt; (int) $book-&gt;id,
            'title' =&gt; $book-&gt;title,
            'year'    =&gt; (int) $book-&gt;yr,
            'links'   =&gt; [
                [
                    'rel' =&gt; 'self',
                    'uri' =&gt; '/books/'.$book-&gt;id,
                ]
            ],
        ];
    }

    /**
     * Include Author
     *
     * @return League\Fractal\ItemResource
     */
    public function includeAuthor(Book $book)
    {
        $author = $book-&gt;author;

        return $this-&gt;item($author, new AuthorTransformer);
    }
}
</code></pre>

<p>These includes will be available but can never be requested unless the <code>Manager::parseIncludes()</code> method is 
called:</p>

<pre><code class="language-php">use League\Fractal;

$fractal = new Fractal\Manager();

if (isset($_GET['include'])) {
    $fractal-&gt;parseIncludes($_GET['include']);
}

</code></pre>

<p>With this set, include can do some great stuff. If a client application were to call the URL <code>/books?include=author</code> then they would see author data in the
response.</p>

<p>These includes can be nested with dot notation too, to include resources within other resources.</p>

<p><strong>E.g:</strong> <code>/books?include=author,publishers,publishers.somethingelse</code></p>

<p>This can be done to a limit of 10 levels. To increase or decrease the level of embedding here, use the <code>Manager::setRecursionLimit(5)</code> 
method with any number you like, to strip it to that many levels. Maybe 4 or 5 would be a smart number, depending on the API.</p>

<h3>Default Includes</h3>

<p>Just like with optional includes, default includes are defined in a property on the transformer:</p>

<pre><code class="language-php">&lt;?php namespace App\Transformer;

use Acme\Model\Book;
use League\Fractal\TransformerAbstract;

class BookTransformer extends TransformerAbstract
{
    /**
     * List of resources to automatically include
     *
     * @var array
     */
    protected $defaultIncludes = [
        'author'
    ];

    // ....

    /**
     * Include Author
     *
     * @return League\Fractal\ItemResource
     */
    public function includeAuthor(Book $book)
    {
        $author = $book-&gt;author;

        return $this-&gt;item($author, new AuthorTransformer);
    }
}
</code></pre>

<p>This will look identical in output as if the user requested <code>?include=author</code>.</p>

<h3>Eager-Loading vrs Lazy-Loading</h3>

<p>This above examples happen to be using the lazy-loading functionality of an ORM for <code>$book-&gt;author</code>. Lazy-Loading
can be notoriously slow, as each time one item is transformered, it would have to go off and find other data leading to a 
huge number of SQL requests.</p>

<p>Eager-Loading could easily be used by inspecting the value of <code>$_GET['include']</code>, and using that to produce a 
list of relationships to eager-load with an ORM.</p>
    </article>
</main>

<footer>
    <span>&copy; Copyright The League of Extraordinary Packages.</span>
    <span>Site design by <a href="http://reinink.ca">Jonathan Reinink</a>.</span>
    <span>Powered by <a href="https://sculpin.io">Sculpin</a>.</span>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="/themes/thephpleague/thephpleague.github.com/js/scripts.js"></script>
<script src="/themes/thephpleague/thephpleague.github.com/js/prism.js"></script>

    <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-46050814-4');ga('send','pageview');
    </script>

</body>
</html>